<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARY DIGITAL DRAMA</title>
    
    <style>
 :root {
    --pink: #ff416c;
    --neon-blue: #00f3ff;
    --neon-purple: #bc00ff;
    --neon-red: #ff0000;
    --dark-bg: #000;
    --header-height: 250px;
    --light: #f5f5f5;
    --secondary: #D4AF37;
}

* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
body { background-color: var(--dark-bg); color: white; overflow-x: hidden; }

/* === LOADING ANIMATION STYLES === */
.drama-loading-grid, .episode-loading-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.drama-loading-grid {
    display: none;
}

.episode-loading-grid {
    display: none;
}

.loading-card {
    background: #222222;
    border-radius: 15px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    border: 1px solid #333;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    width: 100%;
    aspect-ratio: 3/4;
    max-height: 280px;
    overflow: hidden;
}

.loading-image-container {
    width: 150px;
    height: 150px;
    min-width: 150px;
    min-height: 150px;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 12px;
    background: linear-gradient(90deg, #333 0%, #444 50%, #333 100%);
    background-size: 200% 100%;
    animation: loadingShimmer 1.5s infinite linear;
}

.loading-info {
    width: 100%;
    min-height: 40px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    flex-shrink: 0;
    gap: 10px;
}

.loading-title {
    height: 16px;
    background: linear-gradient(90deg, #333 0%, #444 50%, #333 100%);
    background-size: 200% 100%;
    animation: loadingShimmer 1.5s infinite linear;
    border-radius: 4px;
}

.loading-subtitle {
    height: 12px;
    width: 80%;
    margin: 0 auto;
    background: linear-gradient(90deg, #333 0%, #444 50%, #333 100%);
    background-size: 200% 100%;
    animation: loadingShimmer 1.5s infinite linear 0.2s;
    border-radius: 4px;
}

/* Spring/Ripple Animation */
.loader-wrapper {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    flex-direction: column;
}

.loader-container {
    position: relative;
    width: 150px;
    height: 150px;
    margin: 0 auto 20px auto;
    display: flex;
    justify-content: center;
    align-items: center;
}

.loader-ring {
    position: absolute;
    border: 4px solid rgba(255, 65, 108, 0.8);
    border-radius: 50%;
    animation: ripple 2s cubic-bezier(0, 0.2, 0.8, 1) infinite;
}

.loader-ring:nth-child(1) { animation-delay: 0s; }
.loader-ring:nth-child(2) { animation-delay: -0.5s; }
.loader-ring:nth-child(3) { animation-delay: -1s; }

@keyframes ripple {
    0% {
        width: 0;
        height: 0;
        opacity: 1;
    }
    100% {
        width: 100%;
        height: 100%;
        opacity: 0;
    }
}

@keyframes loadingShimmer {
    0% {
        background-position: -200px 0;
    }
    100% {
        background-position: 200px 0;
    }
}

.loading-status-heading {
    color: white;
    font-size: 20px;
    margin-bottom: 10px;
    font-weight: bold;
    text-align: center;
}

.loading-sub-text {
    color: var(--pink);
    font-size: 16px;
    opacity: 0.9;
    text-align: center;
}

.loading-dots {
    color: var(--pink);
    animation: dots 1.5s infinite;
}

@keyframes dots {
    0%, 20% { content: '.'; }
    40% { content: '..'; }
    60%, 100% { content: '...'; }
}

/* === CONTAINER === */
.container { 
    padding: 20px 15px; 
    max-width: 1400px; 
    margin: 0 auto; 
}

/* === PAGE TITLE === */
.page-title {
    text-align: center;
    margin-bottom: 30px;
    padding: 15px;
}

.page-title h1 {
    color: var(--pink);
    font-size: 2.5rem;
    text-shadow: 0 0 10px var(--pink);
    margin-bottom: 10px;
}

.page-title p {
    color: var(--neon-blue);
    font-size: 1rem;
    opacity: 0.8;
}

/* === DRAMA CARDS GRID - UPDATED STYLE === */
.drama-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.drama-card {
    background: #222222;
    border-radius: 15px;
    padding: 15px;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    border: 1px solid #333;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    transition: all 0.3s ease;
    width: 100%;
    aspect-ratio: 3/4;
    max-height: 280px;
    overflow: hidden;
}

.drama-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
    border: 1px solid var(--pink);
    background: #252525;
}

.drama-image-container {
    width: 150px;
    height: 150px;
    min-width: 150px;
    min-height: 150px;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 12px;
    background-color: #000;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.drama-image {
    width: 155px;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.drama-card:hover .drama-image {
    transform: scale(1.05);
}

.image-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(139, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
    border-radius: 10px;
}

.drama-card:hover .image-overlay {
    opacity: 1;
}

.watch-text {
    color: var(--light);
    font-weight: bold;
    font-size: 0.8rem;
    text-align: center;
    padding: 5px 10px;
    border: 2px solid var(--secondary);
    border-radius: 5px;
    background: rgba(0, 0, 0, 0.7);
}

.drama-info {
    width: 100%;
    min-height: 40px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    flex-shrink: 0;
}

.drama-title {
    color: #ffffff;
    font-size: 0.85rem;
    font-weight: bold;
    margin-bottom: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
}

.drama-episodes {
    color: var(--neon-blue);
    font-size: 0.75rem;
    font-weight: 600;
    line-height: 1.3;
}

/* === PAGINATION === */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    margin-top: 30px;
    flex-wrap: wrap;
}

.pagination-btn {
    background: linear-gradient(45deg, var(--pink), var(--neon-purple));
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    min-width: 120px;
    justify-content: center;
}

.pagination-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255, 65, 108, 0.5);
}

.pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.page-info {
    color: var(--neon-blue);
    font-size: 14px;
    background: rgba(0, 243, 255, 0.1);
    padding: 8px 20px;
    border-radius: 20px;
    border: 1px solid var(--neon-blue);
}

/* === EPISODES SECTION === */
.episodes-container {
    display: none;
}

.episodes-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 20px;
}

.episodes-title {
    font-size: 24px;
    color: white;
    border-left: 4px solid var(--pink);
    padding-left: 15px;
}

.episode-count {
    font-size: 14px;
    color: var(--neon-blue);
    background: rgba(0, 243, 255, 0.1);
    padding: 8px 20px;
    border-radius: 20px;
    border: 1px solid var(--neon-blue);
}

/* === EPISODE CARDS WITH IMAGES === */
.episode-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-bottom: 30px;
}

.ep-card {
    background: #111;
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid #333;
    position: relative;
    padding: 2px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.ep-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0, 243, 255, 0.3);
    border-color: var(--neon-blue);
}

.ep-card.active {
    border: none;
    background: linear-gradient(45deg, var(--pink), var(--neon-blue), var(--neon-purple), var(--pink));
    background-size: 400%;
    animation: neonFlow 3s infinite;
}

@keyframes neonFlow { 
    0% { background-position: 0% 50%; } 
    50% { background-position: 100% 50%; } 
    100% { background-position: 0% 50%; } 
}

.ep-inner {
    background: #111;
    border-radius: 8px;
    overflow: hidden;
    height: 100%;
}

.ep-upper {
    position: relative;
    width: 100%;
    aspect-ratio: 16/9;
    overflow: hidden;
}

.ep-upper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.ep-card:hover .ep-upper img {
    transform: scale(1.05);
}

.ep-lower {
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.ep-title {
    color: #ffffff;
    font-size: 13px;
    font-weight: bold;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.3;
}

.ep-duration {
    color: #888;
    font-size: 11px;
}

/* === PLAYER SECTION === */
.player-box {
    display: none;
    position: fixed;
    top: 0 !important;
    left: 0;
    width: 100%;
    height: var(--header-height) !important;
    background: #000;
    z-index: 2000;
    border-bottom: 2px solid var(--pink);
}

.player-content {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
}

.yt-iframe-wrapper {
    position: absolute;
    top: -51px; /* Updated position */
    left: 0;
    width: 100%;
    height: calc(100% + 100px);
    z-index: 1;
    opacity: 0;
    transition: 0.5s;
}

.yt-iframe-wrapper.active { opacity: 1; }
#youtube-player { width: 100%; height: 100%; border: none; }

/* === PLAYER UI CONTROLS === */
.bottom-ui {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0,0,0,0.95));
    padding: 15px 20px;
    z-index: 150;
    opacity: 0;
    transition: 0.3s;
    border-top: 2px solid rgba(255, 65, 108, 0.3);
}

.player-content.show-ui .bottom-ui { opacity: 1; }

.bottom-ui::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(10px);
    z-index: -1;
    border-radius: 20px 20px 0 0;
}

/* Progress bar */
.p-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.15);
    cursor: pointer;
    border-radius: 4px;
    margin-bottom: 15px;
    overflow: hidden;
    position: relative;
    z-index: 2;
}

.p-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--pink), var(--neon-blue));
    width: 0%;
    box-shadow: 0 0 15px var(--pink);
    border-radius: 4px;
}

/* Control Buttons Styling */
.bottom-ui button {
    background: rgba(255, 255, 255, 0.1) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    border-radius: 50%;
    width: 42px;
    height: 42px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    color: white !important;
    cursor: pointer;
}

.bottom-ui button:hover {
    background: var(--pink) !important;
    box-shadow: 0 0 15px var(--pink);
    transform: scale(1.1);
}

/* RESPONSIVE DESKTOP */
@media (min-width: 768px) {
    .episode-grid { grid-template-columns: repeat(4, 1fr); }
    .drama-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); }
    :root { --header-height: 400px; }
}










.pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.page-info {
    color: var(--neon-blue);
    font-size: 14px;
    background: rgba(0, 243, 255, 0.1);
    padding: 8px 20px;
    border-radius: 20px;
    border: 1px solid var(--neon-blue);
}

/* === EPISODES SECTION (Hidden by default) === */
.episodes-container {
    display: none;
}

.episodes-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 20px;
}

.episodes-title {
    font-size: 24px;
    color: white;
    border-left: 4px solid var(--pink);
    padding-left: 15px;
}

.episode-count {
    font-size: 14px;
    color: var(--neon-blue);
    background: rgba(0, 243, 255, 0.1);
    padding: 8px 20px;
    border-radius: 20px;
    border: 1px solid var(--neon-blue);
}

/* === EPISODE CARDS WITH IMAGES === */
.episode-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-bottom: 30px;
}

.ep-card {
    background: #111;
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid #333;
    position: relative;
    padding: 2px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.ep-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0, 243, 255, 0.3);
    border-color: var(--neon-blue);
}

.ep-card.active {
    border: none;
    background: linear-gradient(45deg, var(--pink), var(--neon-blue), var(--neon-purple), var(--pink));
    background-size: 400%;
    animation: neonFlow 3s infinite;
}

@keyframes neonFlow { 
    0% { background-position: 0% 50%; } 
    50% { background-position: 100% 50%; } 
    100% { background-position: 0% 50%; } 
}

.ep-inner {
    background: #111;
    border-radius: 8px;
    overflow: hidden;
    height: 100%;
}

.ep-upper {
    position: relative;
    width: 100%;
    aspect-ratio: 16/9;
    overflow: hidden;
}

.ep-upper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.ep-card:hover .ep-upper img {
    transform: scale(1.05);
}

.ep-lower {
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.ep-title {
    color: #ffffff;
    font-size: 13px;
    font-weight: bold;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.3;
}

.ep-duration {
    color: #888;
    font-size: 11px;
}

/* === PLAYER SECTION (FIXED AT TOP) === */
.player-box {
    display: none;
    position: fixed;
    top: 0 !important;
    left: 0;
    width: 100%;
    height: var(--header-height) !important;
    background: #000;
    z-index: 2000;
    border-bottom: 2px solid var(--pink);
}

.player-content {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
}

#bufferingScreen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    z-index: 100;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.neon-loader {
    width: 50px;
    height: 50px;
    border: 4px solid transparent;
    border-top: 4px solid var(--pink);
    border-bottom: 4px solid var(--neon-blue);
    border-radius: 50%;
    animation: spinNeon 1s linear infinite;
}

@keyframes spinNeon { to { transform: rotate(360deg); } }

.yt-iframe-wrapper {
    position: absolute;
    top: -51px;
    left: 0;
    width: 100%;
    height: calc(100% + 100px);
    z-index: 1;
    opacity: 0;
    transition: 0.5s;
}

.yt-iframe-wrapper.active { opacity: 1; }
#youtube-player { width: 100%; height: 100%; border: none; }

/* === CENTER CONTROLS === */
.center-controls {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    gap: 80px;
    z-index: 160;
    opacity: 0;
    transition: 0.3s;
    pointer-events: none;
}

.player-content.show-ui .center-controls { 
    opacity: 1; 
    pointer-events: auto; 
}

.skip-btn {
    background: rgba(0, 0, 0, 0.7) !important;
    backdrop-filter: blur(5px);
    border: 2px solid var(--neon-blue);
    color: white;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    transition: all 0.3s ease;
}

.skip-btn:hover {
    background: rgba(0, 0, 0, 0.9) !important;
    transform: scale(1.1);
    box-shadow: 0 0 15px var(--neon-blue);
}

.skip-btn span {
    font-size: 20px;
    margin-bottom: 2px;
}

/* === BOTTOM CONTROLS WITH BLACK CONTAINER === */
.bottom-ui {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0,0,0,0.95));
    padding: 15px 20px;
    z-index: 150;
    opacity: 0;
    transition: 0.3s;
    border-top: 2px solid rgba(255, 65, 108, 0.3);
}

.player-content.show-ui .bottom-ui { opacity: 1; }

.bottom-ui::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(10px);
    z-index: -1;
    border-radius: 20px 20px 0 0;
}

/* Progress bar */
.p-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.15);
    cursor: pointer;
    border-radius: 4px;
    margin-bottom: 15px;
    overflow: hidden;
    position: relative;
    z-index: 2;
}

.p-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--pink), var(--neon-blue));
    width: 0%;
    box-shadow: 0 0 15px var(--pink);
    border-radius: 4px;
    position: relative;
}

.p-fill::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 3px;
    height: 100%;
    background: white;
    box-shadow: 0 0 10px white;
}

/* Controls container */
.bottom-ui > div {
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    z-index: 2;
}

/* Left controls group */
.bottom-ui > div > div:first-child {
    display: flex;
    gap: 20px;
    align-items: center;
    background: rgba(0, 0, 0, 0.6);
    padding: 8px 15px;
    border-radius: 30px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* Controls buttons styling */
.bottom-ui button {
    background: rgba(255, 255, 255, 0.1) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    border-radius: 50%;
    width: 42px;
    height: 42px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    color: white !important;
    font-size: 18px !important;
    cursor: pointer;
}

.bottom-ui button:hover {
    background: rgba(255, 65, 108, 0.8) !important;
    transform: scale(1.1);
    box-shadow: 0 0 15px var(--pink);
    border-color: var(--pink) !important;
}

/* Play/Pause button special styling */
.bottom-ui button:nth-child(2) {
    width: 48px !important;
    height: 48px !important;
    font-size: 22px !important;
    background: var(--pink) !important;
    border: none !important;
}

.bottom-ui button:nth-child(2):hover {
    background: var(--pink) !important;
    box-shadow: 0 0 20px var(--pink);
    transform: scale(1.15);
}

/* Time display */
.bottom-ui span {
    font-size: 14px;
    font-weight: bold;
    color: white;
    text-shadow: 0 0 5px var(--neon-blue);
    background: rgba(0, 0, 0, 0.5);
    padding: 5px 12px;
    border-radius: 20px;
    border: 1px solid rgba(0, 243, 255, 0.3);
    min-width: 90px;
    text-align: center;
}

/* Fullscreen button */
.bottom-ui button:last-child {
    background: rgba(0, 243, 255, 0.2) !important;
    border: 1px solid rgba(0, 243, 255, 0.4) !important;
}

.bottom-ui button:last-child:hover {
    background: rgba(0, 243, 255, 0.6) !important;
    border-color: var(--neon-blue) !important;
    box-shadow: 0 0 15px var(--neon-blue);
}

.close-player-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: rgba(0,0,0,0.8);
    backdrop-filter: blur(5px);
    border: 2px solid var(--pink);
    color: white;
    cursor: pointer;
    z-index: 200;
    opacity: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.player-content.show-ui .close-player-btn { opacity: 1; }

.close-player-btn:hover {
    background: rgba(0, 0, 0, 1) !important;
    transform: scale(1.1);
    box-shadow: 0 0 10px var(--pink);
}

/* === BACK BUTTON === */
.back-button {
    background: linear-gradient(45deg, var(--pink), var(--neon-purple));
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 20px;
    transition: all 0.3s ease;
}

.back-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255, 65, 108, 0.5);
}

/* === TOUCH LAYER === */
#touchLayer {
    z-index: 10;
    cursor: pointer;
}

/*  rule         */
body.player-open .episodes-container {
    margin-top: 20px;
}

/* === LOADING STATES === */
.loading { text-align: center; padding: 30px; }
.error-message { color: var(--neon-red); padding: 20px; }
.retry-btn {
    background: var(--pink);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
    font-weight: bold;
}

/* === RESPONSIVE === */
@media (min-width: 768px) {
    .episode-grid { grid-template-columns: repeat(4, 1fr); }
    .drama-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); }
    
    :root { --header-height: 400px; }
    .skip-btn { width: 60px; height: 60px; font-size: 12px; }
    
    .drama-image-container {
        width: 160px;
        height: 160px;
        min-width: 160px;
        min-height: 160px;
    }

    .bottom-ui > div > div:first-child {
        gap: 25px;
        padding: 10px 20px;
    }

    .bottom-ui button {
        width: 44px;
        height: 44px;
    }

    .bottom-ui button:nth-child(2) {
        width: 50px !important;
        height: 50px !important;
    }
}

@media (max-width: 480px) {
    .drama-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }
    
    .drama-card {
        aspect-ratio: 3/4;
        max-height: 230px;
        padding: 10px;
    }
    
    .drama-image-container {
        width: 120px;
        height: 120px;
        min-width: 120px;
        min-height: 120px;
        margin-bottom: 10px;
    }
    
    .drama-title {
        font-size: 0.8rem;
    }
    
    .drama-episodes {
        font-size: 0.7rem;
    }
    
    .episode-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }
    
    .ep-title {
        font-size: 12px;
    }
    
    .episodes-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    :root { --header-height: 200px; }

    /* Mobile responsive for player */
    .center-controls {
        gap: 40px;
    }

    .skip-btn {
        width: 50px;
        height: 50px;
        font-size: 10px;
    }

    .skip-btn span {
        font-size: 18px;
    }

    .bottom-ui {
        padding: 10px 12px;
    }

    .bottom-ui::before {
        backdrop-filter: blur(5px);
    }

    .p-bar {
        height: 6px;
        margin-bottom: 12px;
    }

    .bottom-ui > div > div:first-child {
        padding: 5px 10px;
        gap: 10px;
    }

    .bottom-ui button {
        width: 32px;
        height: 32px;
        font-size: 14px !important;
    }

    .bottom-ui button:nth-child(2) {
        width: 36px !important;
        height: 36px !important;
        font-size: 16px !important;
    }

    .bottom-ui span {
        font-size: 11px;
        padding: 3px 8px;
        min-width: 70px;
    }
}

@media (min-width: 1200px) {
    .drama-grid {
        grid-template-columns: repeat(5, 1fr);
    }
    
    .drama-card {
        max-height: 280px;
    }
    
    .drama-image-container {
        width: 140px;
        height: 140px;
        min-width: 140px;
        min-height: 140px;
    }
}

@media (max-width: 360px) {
    .drama-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    
    .drama-card {
        max-height: 210px;
        padding: 8px;
    }
    
    .drama-image-container {
        width: 155px;
        height: 88px;
        min-width: 110px;
        min-height: 88px;
    }
    
    .drama-title {
        font-size: 0.75rem;
    }
    
    .drama-episodes {
        font-size: 0.65rem;
    }
}
    </style>
</head>
<body>

    <!-- FULL SCREEN LOADER -->
    <div class="loader-wrapper" id="fullScreenLoader">
        <div class="loader-container">
            <div class="loader-ring"></div>
            <div class="loader-ring"></div>
            <div class="loader-ring"></div>
        </div>
        <div class="loading-status-heading" id="loaderTitle">GREEN TV HD Dramas</div>
        <div class="loading-sub-text" id="loaderText">Please wait<span class="loading-dots">...</span></div>
    </div>

    <!-- PLAYER SECTION (FIXED AT TOP) -->
    <div class="player-box" id="playerBox">
        <div class="player-content" id="playerArea" onclick="handleUIInteraction()">
            <div id="bufferingScreen">
                <div class="neon-loader"></div>
                <div class="loading-text">BUFFERING...</div>
            </div>

            <div class="yt-iframe-wrapper" id="ytWrapper">
                <div id="youtube-player"></div>
            </div>

            <button class="close-player-btn" onclick="closePlayer(event)">×</button>

            <div style="position:absolute; inset:0; z-index:5;" id="touchLayer"></div>

            <div class="bottom-ui" onclick="event.stopPropagation()">
                <div class="p-bar" onclick="seek(event)">
                    <div class="p-fill" id="pFill"></div>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="display:flex; gap:15px; align-items:center;">
                        <button style="background:none; border:none; color:white; font-size:18px;" onclick="skip(-10)">↺ 10s</button>
                        <button style="background:none; border:none; color:white; font-size:22px;" onclick="playPause()" id="playIcon">||</button>
                        <button style="background:none; border:none; color:white; font-size:18px;" onclick="skip(10)">↻ 10s</button>
                        <span style="font-size:11px;"><span id="currTime">0:00</span> / <span id="totalTime">0:00</span></span>
                    </div>
                    <button style="background:none; border:none; color:white; font-size:18px;" onclick="toggleFullscreen()">⛶</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="container">
        <!-- Back Button (Hidden by default) -->
        <button class="back-button" id="backButton" style="display: none;" onclick="goBackToDramas()">
      ← All Dramas
        </button>
        
        <!-- Drama Grid Loading Skeleton -->
        <div id="dramaLoadingSection">
            <div class="drama-loading-grid" id="dramaLoadingGrid">
                <!-- Loading skeleton will be inserted here -->
            </div>
        </div>
        
        <!-- Drama Grid (Initial View) -->
        <div id="dramaSection" style="display: none;">
            <div class="drama-grid" id="dramaGrid">
                <!-- Drama cards will be inserted here -->
            </div>
            
            <!-- Drama Pagination -->
            <div class="pagination" id="dramaPagination" style="display: none;">
                <button class="pagination-btn" id="dramaPrevBtn" onclick="changeDramaPage(-1)">
              ← Previous
                </button>
                <div class="page-info" id="dramaPageInfo">Page 1 of 1</div>
                <button class="pagination-btn" id="dramaNextBtn" onclick="changeDramaPage(1)">
                    Next →
                </button>
            </div>
        </div>
        
        <!-- Episodes Container (Hidden by default) -->
        <div class="episodes-container" id="episodesContainer">
            <div class="episodes-header">
                <h2 class="episodes-title" id="episodesTitle">
                    <span id="dramaName">Select Episode</span>
                </h2>
                <div class="episode-count" id="episodeCount">0 Episodes</div>
            </div>
            
            <!-- Episode Loading Skeleton -->
            <div id="episodeLoadingSection" style="display: none;">
                <div class="episode-loading-grid" id="episodeLoadingGrid">
                    <!-- Loading skeleton will be inserted here -->
                </div>
            </div>
            
            <!-- Episode Grid -->
            <div class="episode-grid" id="episodeGrid">
                <!-- Episode cards with images will be inserted here -->
            </div>
            
            <!-- Episode Pagination -->
            <div class="pagination" id="episodePagination" style="display: none;">
                <button class="pagination-btn" id="episodePrevBtn" onclick="changeEpisodePage(-1)">
                    ← Previous
                </button>
                <div class="page-info" id="episodePageInfo">Page 1 of 1</div>
                <button class="pagination-btn" id="episodeNextBtn" onclick="changeEpisodePage(1)">
                    Next →
                </button>
            </div>
        </div>
        
        <div style="margin-top:30px; color:#555; font-size:12px; text-align:center;">
            Powered By: Syed Muzammil Shah Bukari
        </div>
    </div>

    <script>
    // Configuration
const API_KEY = 'AIzaSyACxqw-OnpXUZFv7ym_PTiH4QkdX_KRsN4';
const DEFAULT_THUMBNAIL = "https://images.pexels.com/photos/713149/pexels-photo-713149.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1";
const ITEMS_PER_PAGE = 30;

// Drama Data - Fixed: "undefined" replaced with "Green TV Serial"
const DRAMAS = [
    {
        title: "Fasaana Mart",
        playlistId: 'PLs2CG9JU32b7pGIyYk0jsGOrUIa_Ou2qF',
        description: "Green TV Serial",
    },
    {
        title: "Maa",
        playlistId: 'PLs2CG9JU32b4tzGXlIkA0I0lveE7GWgS1',
        description: "Green TV Serial",
    },
    {
        title: "Rahguzar",
        playlistId: 'PLs2CG9JU32b4Xup0ey7YL5775CqA8zNBr',
        description: "Green TV Serial",
    },
    {
        title: "Ghulam Bashah Sundri",
        playlistId: 'PLs2CG9JU32b5vX4zz3fN1xJHavj4ZgSk2',
        description: "Green TV Serial",
    },
    {
        title: "Humnava",
        playlistId: 'PLs2CG9JU32b6Gnt65DgyKmc7uunxVvq5O',
        description: "Green TV Serial",
    },
    {
        title: "Faaslay",
        playlistId: 'PLs2CG9JU32b7Fnm0nMQOCcAL4Z4ybPX4M',
        description: "Green TV Serial",
    },
    {
        title: "Visaal E Ishq",
        playlistId: 'PLs2CG9JU32b6wEtS1W_6TgdK0TxJoV7IL',
        description: "Green TV Serial",
    },
    {
        title: "Aik Bhool",
        playlistId: 'PLs2CG9JU32b6Lrlqm1ug2MEae-dsQoUwL',
        description: "Green TV Serial",
    },
    {
        title: "Main Zameen Tu Aasmaan",
        playlistId: 'PLs2CG9JU32b5UvgEP1WvYzhj9ufFDsD2E',
        description: "Green TV Serial",
    },
    {
        title: "Pamaal",
        playlistId: 'PLs2CG9JU32b54KxkYkqpuk55CT4idd4Y7',
        description: "Green TV Serial",
    },
    {
        title: "Sharakat",
        playlistId: 'PLs2CG9JU32b6FDwgSsa5OsgHuLSRaEBjv',
        description: "Green TV Serial",
    },
    {
        title: "Ishq Di Chashni HD",
        playlistId: 'PLs2CG9JU32b4EbRwbDMDeIiQRo49jyO3y',
        description: "Green TV Serial",
    },
    {
        title: "Naqsh",
        playlistId: 'PLs2CG9JU32b5u9Ak4XnG4CjRQTV5ogs0q',
        description: "Green TV Serial",
    },
    {
        title: "Shikaar HD",
        playlistId: 'PLs2CG9JU32b4P2Yeu-ogE3BOUTMKY3WNd',
        description: "Green TV Serial",
    },
    {
        title: "Kabli Pulao HD",
        playlistId: 'PLs2CG9JU32b7o-ifQPBi5zcRwBrMsxRjS',
        description: "Green TV Serial",
    },
    {
        title: "Do Kinaray",
        playlistId: 'PLs2CG9JU32b7kNGvHqlW5c1fJcqbDYmgU',
        description: "Green TV Serial",
    },
    {
        title: "Dil Manay Na",
        playlistId: 'PLs2CG9JU32b7gTjMOiZKmZ4mV4VU3JV7D',
        description: "Green TV Serial",
    },
    {
        title: "Jindo",
        playlistId: 'PLs2CG9JU32b6r1foTjB3crwFBDecV7Lbi',
        description: "Green TV Serial",
    },
    {
        title: "Behroopia",
        playlistId: 'PLs2CG9JU32b7kUs90mI4YW469yPXNeMV_',
        description: "Green TV Serial",
    },
    {
        title: "Ishq Tum Se Hua",
        playlistId: 'PLs2CG9JU32b6ufVzx0RVq6BsA9SnX1clg',
        description: "Green TV Serial",
    },
    {
        title: "Zarb e Mehmet",
        playlistId: 'PLs2CG9JU32b4HNteU_MuyyrsD-dR2WsgA',
        description: "Green TV Serial",
    },
    {
        title: "Na Tum Jano Na Hum",
        playlistId: 'PLs2CG9JU32b5GP2hYAqsFoMfO57mROa3k',
        description: "Green TV Serial",
    },
    {
        title: "Ishq Di Chashni",
        playlistId: 'PLs2CG9JU32b6Bwut0tGPDGhJr0mgA032z',
        description: "Green TV Serial",
    },
    {
        title: "Mehmed: Fetihler Sultani - The Undefeated Warrior",
        playlistId: 'PLs2CG9JU32b5DhjPf3osEagmdBkpe-rbA',
        description: "Green TV Serial",
    },
    {
        title: "Mohabbat Aur Mehangai",
        playlistId: 'PLs2CG9JU32b6ukwJaPYHm_EjVaY5TGUID',
        description: "Green TV Serial",
    },
    {
        title: "Diyar-e-Yaar",
        playlistId: 'PLs2CG9JU32b5lf42cmQxVuP7eFswrqxrh',
        description: "Green TV Serial",
    },
    {
        title: "Faraar",
        playlistId: 'PLs2CG9JU32b4AMQXxXoxjN8lwbISb30Cr',
        description: "Green TV Serial",
    },
    {
        title: "Shehzadi House",
        playlistId: 'PLs2CG9JU32b5ie8s6SK2KhlEIGVEaWVmO',
        description: "Green TV Serial",
    },
    {
        title: "Mooray Piya",
        playlistId: 'PLs2CG9JU32b7uNVD4GFHE-tDmge9SrkPI',
        description: "Green TV Serial",
    },
    {
        title: "DuniyaPur",
        playlistId: 'PLs2CG9JU32b73PLNzMrJBMHLKhKB2rweC',
        description: "Green TV Serial",
    },
    {
        title: "Iqtidar",
        playlistId: 'PLs2CG9JU32b6PZLvuxABUgtUhsk29CIqA',
        description: "Green TV Serial",
    },
    {
        title: "Ishq Beparwah",
        playlistId: 'PLs2CG9JU32b5_CiR5MrQ6u81mJieztvhk',
        description: "Green TV Serial",
    },
    {
        title: "Meray Ranjhna",
        playlistId: 'PLs2CG9JU32b4Zs81f9bewmQoUPQ-woHhc',
        description: "Green TV Serial",
    },
    {
        title: "Dil Ka Kya Karein",
        playlistId: 'PLs2CG9JU32b7sYL3sGCa_o9CDjNrCPWyb',
        description: "Green TV Serial",
    },
    {
        title: "Gentleman",
        playlistId: 'PLs2CG9JU32b4AjRCWduY-KAXbSaPCLVje',
        description: "Green TV Serial",
    },
    {
        title: "Let's Try Mohabbat",
        playlistId: 'PLs2CG9JU32b4JMABh0Vru6oibmetiKnCr',
        description: "Green TV Serial",
    },
    {
        title: "Dua Aur Azan",
        playlistId: 'PLs2CG9JU32b5HjpP9opxjRa4HBE-cSI70',
        description: "Green TV Serial",
    },
    {
        title: "Yaar e Mann",
        playlistId: 'PLs2CG9JU32b59m44fwgIdTgPXYlfBU3hW',
        description: "Green TV Serial",
    },
    {
        title: "Pas e Deewar",
        playlistId: 'PLs2CG9JU32b5Fw30QApo86RweSPhMu2qJ',
        description: "Green TV Serial",
    },
    {
        title: "Rafta Rafta",
        playlistId: 'PLs2CG9JU32b5IcCyi2m-x8_oh-QSh7HxA',
        description: "Green TV Serial",
    },
    {
        title: "Nasihat",
        playlistId: 'PLs2CG9JU32b5jIU2L8AVX-T6l4hm3HaYR',
        description: "Green TV Serial",
    },
    {
        title: "FANAA",
        playlistId: 'PLs2CG9JU32b5L1Rt_IyZumpryulwW5r7D',
        description: "Green TV Serial",
    },
    {
        title: "Pagal Khana",
        playlistId: 'PLs2CG9JU32b7HiOA-29HKwhzfVKmsi_Mj',
        description: "Green TV Serial",
    },
    {
        title: "Akhara",
        playlistId: 'PLs2CG9JU32b7iF3Iszyd63vxm47qeYysE',
        description: "Green TV Serial",
    },
    {
        title: "Mohabbat Satrangi",
        playlistId: 'PLs2CG9JU32b6IPJTflvjKk0qSswFpBo3p',
        description: "Green TV Serial",
    },
    {
        title: "Serial Killer",
        playlistId: 'PLs2CG9JU32b45e7UA849qZ4NcRJSPMqTD',
        description: "Green TV Serial",
    },
    {
        title: "Ek Jhooti Love Story",
        playlistId: 'PLs2CG9JU32b4rScQ5TPxsUo33vgtrB1zy',
        description: "Green TV Serial",
    },
    {
        title: "Standup Girl",
        playlistId: 'PLs2CG9JU32b5UKvnzUVjQEZO95asLTgZ0',
        description: "Green TV Serial",
    },
    {
        title: "Mor Chaal",
        playlistId: 'PLs2CG9JU32b7-TTBNOH7KRS7E74bWXjgJ',
        description: "Green TV Serial",
    },
    {
        title: "Breaking News",
        playlistId: 'PLs2CG9JU32b6HPfEdy-xoq6eDdIuMBiRM',
        description: "Green TV Serial",
    },
    {
        title: "Grey",
        playlistId: 'PLs2CG9JU32b4PcWmvVXa0kbRLsMRNixdu',
        description: "Green TV Serial",
    },
    {
        title: "Shikaar",
        playlistId: 'PLs2CG9JU32b52Ul6IU80wdqFFCq1zZdv1',
        description: "Green TV Serial",
    },
    {
        title: "Gumn",
        playlistId: 'PLs2CG9JU32b5Tn0j3JC9NtKx9RmDvlxoF',
        description: "Green TV Serial",
    },
    {
        title: "Fatima Feng",
        playlistId: 'PLs2CG9JU32b6JHOpemzKi-vi_SEjjv6Mp',
        description: "Green TV Serial",
    },
    {
        title: "Working Women",
        playlistId: 'PLs2CG9JU32b6ngAr1tG1ICVfkBeS-jHqf',
        description: "Green TV Serial",
    },
    {
        title: "22 Qadam",
        playlistId: 'PLs2CG9JU32b4iAMLdzNQV3VEKxVM7XGl1',
        description: "Green TV Serial",
    },
    {
        title: "Wonderland",
        playlistId: 'PLs2CG9JU32b7BIw3Z6xp-JdOBNENzUxSc',
        description: "Green TV Serial",
    },
    {
        title: "Idiot",
        playlistId: 'PLs2CG9JU32b4UwLrQVDkcXrJLf-GUXEPj',
        description: "Green TV Serial",
    },
    {
        title: "Apney Hee Tou Hain",
        playlistId: 'PLs2CG9JU32b4LNAnlbjT_TH0I2eDvl66N',
        description: "Green TV Serial",
    },
    {
        title: "101 Talaqain",
        playlistId: 'PLs2CG9JU32b4SRVIsZ7mnRUQxKhVZ-4lB',
        description: "Green TV Serial",
    },
    {
        title: "Nauroz",
        playlistId: 'PLs2CG9JU32b4G9eUZ0CXVre0CXJgzOJbJ',
        description: "Green TV Serial",
    },
    {
        title: "Daurr",
        playlistId: 'PLs2CG9JU32b5EOOJIO_LbupzzvN3Dfr8E',
        description: "Green TV Serial",
    },
    {
        title: "College Gate",
        playlistId: 'PLs2CG9JU32b7STz23L-FCtpwCgOLwcSkQ',
        description: "Green TV Serial",
    },
    {
        title: "Shanaas",
        playlistId: 'PLs2CG9JU32b6rrpEHQCRsc-NLtuAeTJq1',
        description: "Green TV Serial",
    },
    {
        title: "Honey Moon",
        playlistId: 'PLs2CG9JU32b7XWJqPO_YPev5EbRG6HLH1',
        description: "Green TV Serial",
    },
    {
        title: "Tumharey Husn Kay Naam",
        playlistId: 'PLs2CG9JU32b51JhgFUUEcgV8lh5kq_kAi',
        description: "Green TV Serial",
    },
    {
        title: "Kabli Pulao",
        playlistId: 'PLs2CG9JU32b6vqj8XCbS0GqeYWrIdF4T0',
        description: "Green TV Serial",
    },
    {
        title: "Siyaah Series",
        playlistId: 'PLs2CG9JU32b7PXjJBeAqRyUFtLfnINHuM',
        description: "Green TV Serial",
    },
    {
        title: "Jeevan Nagar",
        playlistId: 'PLs2CG9JU32b5u89QIvVXowiDrBcFaCn6j',
        description: "Green TV Serial",
    }
];

// --- Variables ---
let player, currentIdx = 0, hideTimeout;
let videoList = []; 
let currentDramaIndex = -1;
let isBuffering = false;
let isInEpisodesView = false;
let dramaCurrentPage = 1, dramaTotalPages = 1;
let episodeCurrentPage = 1, episodeTotalPages = 1;
let loaderTimeout;

// --- Initialization & Navigation ---
window.onload = () => {
    setupBrowserHistory();
    initializeLoader();
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(tag);
};

function setupBrowserHistory() {
    history.replaceState({ page: 'dramas' }, '', window.location.pathname);
    window.addEventListener('popstate', (e) => {
        if (e.state?.page === 'dramas' && isInEpisodesView) goBackToDramas();
        else if (e.state?.page === 'episodes' && !isInEpisodesView && currentDramaIndex >= 0) openDrama(currentDramaIndex, true);
    });
}

function updatePageTitle(title = 'DRAMA HUB') { document.title = title + ' - DRAMA HUB'; }

// --- LOADER FUNCTIONS ---
function initializeLoader() {
    updateLoaderText('Loading Dramas');
    setTimeout(() => {
        initializeDramas();
        hideFullScreenLoader();
    }, 1500);
}

function updateLoaderText(text) {
    const el = document.getElementById('loaderText');
    if(el) el.innerHTML = `${text}<span class="loading-dots">...</span>`;
}

function showFullScreenLoader(text = 'Loading') {
    clearTimeout(loaderTimeout);
    document.getElementById('fullScreenLoader').style.display = 'flex';
    updateLoaderText(text);
}

function hideFullScreenLoader() {
    loaderTimeout = setTimeout(() => {
        document.getElementById('fullScreenLoader').style.display = 'none';
    }, 500);
}

// --- Loading Skeletons ---
function createDramaLoadingSkeleton(count = 6) {
    const grid = document.getElementById('dramaLoadingGrid');
    if(!grid) return;
    grid.innerHTML = '';
    for (let i = 0; i < count; i++) {
        const card = document.createElement('div');
        card.className = 'loading-card';
        card.innerHTML = `<div class="loading-image-container"></div><div class="loading-info"><div class="loading-title"></div><div class="loading-subtitle"></div></div>`;
        grid.appendChild(card);
    }
}

function createEpisodeLoadingSkeleton(count = 8) {
    const grid = document.getElementById('episodeLoadingGrid');
    if(!grid) return;
    grid.innerHTML = '';
    for (let i = 0; i < count; i++) {
        const card = document.createElement('div');
        card.className = 'loading-card';
        card.innerHTML = `<div class="loading-image-container" style="height: 120px; min-height: 120px;"></div><div class="loading-info"><div class="loading-title"></div><div class="loading-subtitle"></div></div>`;
        grid.appendChild(card);
    }
}

// --- Drama Logic ---
function initializeDramas() {
    createDramaLoadingSkeleton();
    document.getElementById('dramaLoadingSection').style.display = 'block';
    document.getElementById('dramaSection').style.display = 'none';
    
    setTimeout(() => {
        const grid = document.getElementById('dramaGrid');
        grid.innerHTML = '';
        dramaTotalPages = Math.ceil(DRAMAS.length / ITEMS_PER_PAGE);
        const start = (dramaCurrentPage - 1) * ITEMS_PER_PAGE;
        const end = Math.min(start + ITEMS_PER_PAGE, DRAMAS.length);

        for (let i = start; i < end; i++) {
            const d = DRAMAS[i];
            const card = document.createElement('div');
            card.className = 'drama-card';
            card.innerHTML = `<div class="drama-image-container"><div class="placeholder-img">Loading...</div><div class="image-overlay"><div class="watch-text">Watch Now</div></div></div><div class="drama-info"><div class="drama-title">${d.title}</div><div class="drama-episodes">${d.description}</div></div>`;
            card.onclick = () => openDrama(i);
            fetchDramaThumbnail(d.playlistId, card);
            grid.appendChild(card);
        }
        
        document.getElementById('dramaLoadingSection').style.display = 'none';
        document.getElementById('dramaSection').style.display = 'block';
        updateDramaPagination();
    }, 1000);
}

async function fetchDramaThumbnail(pid, card) {
    try {
        const res = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=1&playlistId=${pid}&key=${API_KEY}`);
        const data = await res.json();
        if (data.items?.[0]) {
            const thumb = data.items[0].snippet.thumbnails.high?.url || DEFAULT_THUMBNAIL;
            card.querySelector('.placeholder-img').innerHTML = `<img src="${thumb}" class="drama-image" onerror="this.src='${DEFAULT_THUMBNAIL}'">`;
        }
    } catch (e) { console.error(e); }
}

// --- Episode Logic ---
async function openDrama(idx, fromHist = false) {
    currentDramaIndex = idx;
    const d = DRAMAS[idx];
    updatePageTitle(d.title);
    showFullScreenLoader(`Loading ${d.title} Episodes`);
    
    document.getElementById('dramaSection').style.display = 'none';
    document.getElementById('backButton').style.display = 'inline-flex';
    document.getElementById('episodesContainer').style.display = 'block';
    document.getElementById('dramaName').textContent = d.title;
    isInEpisodesView = true;
    
    createEpisodeLoadingSkeleton();
    document.getElementById('episodeLoadingSection').style.display = 'block';
    document.getElementById('episodeGrid').style.display = 'none';

    if (!fromHist) history.pushState({ page: 'episodes', dramaIndex: idx }, '', `#${d.title.replace(/\s+/g, '-').toLowerCase()}`);
    
    try {
        const all = await fetchAllVideos(d.playlistId);
        videoList = sortEpisodes(all);
        document.getElementById('episodeCount').textContent = `${videoList.length} Episodes`;
        episodeTotalPages = Math.ceil(videoList.length / ITEMS_PER_PAGE);
        
        hideFullScreenLoader();
        document.getElementById('episodeLoadingSection').style.display = 'none';
        document.getElementById('episodeGrid').style.display = 'grid';
        displayEpisodes(1);
    } catch (error) {
        hideFullScreenLoader();
        document.getElementById('episodeLoadingSection').style.display = 'none';
        const grid = document.getElementById('episodeGrid');
        grid.style.display = 'block';
        grid.innerHTML = `<div class="error-message">Failed to load episodes. Please try again.</div>`;
    }
}

function sortEpisodes(list) {
    if (list.length < 2) return list;
    const getNum = (t) => { const m = t.match(/\d+/); return m ? parseInt(m[0]) : 0; };
    if (getNum(list[0].snippet.title) > getNum(list[list.length-1].snippet.title)) return list.reverse();
    return list;
}

// ✅ Updated: Private videos filter karna
async function fetchAllVideos(pid) {
    let all = [], token = null;
    try {
        do {
            const res = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${pid}&key=${API_KEY}${token ? `&pageToken=${token}` : ''}`);
            const data = await res.json();
            if (data.items) {
                // Sirf public videos filter karo
                const publicVideos = data.items.filter(item => 
                    item.snippet.title !== 'Private video' && 
                    !item.snippet.title.toLowerCase().includes('private')
                );
                all = all.concat(publicVideos);
            }
            token = data.nextPageToken;
        } while (token);
    } catch (e) { console.error(e); }
    return all;
}

// ✅ Updated: Display episodes with private video check
function displayEpisodes(page) {
    episodeCurrentPage = page;
    const grid = document.getElementById('episodeGrid');
    grid.innerHTML = '';
    const start = (page - 1) * ITEMS_PER_PAGE;
    const end = Math.min(start + ITEMS_PER_PAGE, videoList.length);

    for (let i = start; i < end; i++) {
        const v = videoList[i];
        
        // ✅ Extra safety: Agar private video ho to skip
        if (v.snippet.title === 'Private video' || v.snippet.title.toLowerCase().includes('private')) {
            continue;
        }

        const card = document.createElement('div');
        card.className = 'ep-card';
        card.innerHTML = `<div class="ep-inner"><div class="ep-upper"><img src="${v.snippet.thumbnails?.high?.url || DEFAULT_THUMBNAIL}" loading="lazy"></div><div class="ep-lower"><div class="ep-title">${v.snippet.title}</div></div></div>`;
        card.onclick = () => openPlayer(i);
        grid.appendChild(card);
    }
    updateEpisodePagination();
}

function goBackToDramas() {
    document.getElementById('episodesContainer').style.display = 'none';
    document.getElementById('backButton').style.display = 'none';
    document.getElementById('dramaSection').style.display = 'block';
    closePlayer();
    updatePageTitle();
    isInEpisodesView = false;
    history.pushState({ page: 'dramas' }, '', window.location.pathname);
}

// --- Player Logic ---
function openPlayer(idx) {
    if (!videoList[idx]) return;
    currentIdx = idx;
    const vId = videoList[idx].snippet.resourceId.videoId;
    
    document.getElementById('playerBox').style.display = 'block';
    document.getElementById('bufferingScreen').style.display = 'flex';
    document.getElementById('ytWrapper').style.opacity = '0';
    document.body.classList.add('player-open');
    
    if (player?.loadVideoById) {
        player.loadVideoById(vId);
    }
    
    setTimeout(forceHideLoader, 4000);
    showControls();
}

function forceHideLoader() {
    const loader = document.getElementById('bufferingScreen');
    const wrapper = document.getElementById('ytWrapper');
    if(loader.style.display !== 'none') {
        loader.style.display = 'none';
        wrapper.style.opacity = '1';
        isBuffering = false;
    }
}

// --- YouTube API Events ---
function onYouTubeIframeAPIReady() {
    player = new YT.Player('youtube-player', {
        height: '100%', width: '100%',
        playerVars: { 'autoplay': 1, 'controls': 0, 'playsinline': 1, 'rel': 0, 'modestbranding': 1, 'enablejsapi': 1 },
        events: { 
            'onStateChange': onStateChange,
            'onReady': () => { setInterval(updateProgressBar, 500); }
        }
    });
}

function onStateChange(event) {
    const loader = document.getElementById('bufferingScreen');
    const wrapper = document.getElementById('ytWrapper');

    const isAdPlaying = (player && typeof player.getAdState === 'function' && player.getAdState() === 1);

    if (event.data === YT.PlayerState.PLAYING) {
        isBuffering = false;
        loader.style.display = 'none';
        wrapper.style.opacity = '1';
        document.getElementById('playIcon').innerText = '||';
        showControls();
    } 
    else if (event.data === YT.PlayerState.BUFFERING) {
        if (isAdPlaying) {
            loader.style.display = 'none';
            wrapper.style.opacity = '1';
        } else {
            isBuffering = true;
            loader.style.display = 'flex';
        }
    } 
    else if (event.data === YT.PlayerState.PAUSED) {
        isBuffering = false;
        document.getElementById('playIcon').innerText = '▶';
        showControls(); 
    }
    else if (event.data === -1) {
        wrapper.style.opacity = '1';
        setTimeout(forceHideLoader, 1500);
    }
}

function updateProgressBar() {
    if (player?.getCurrentTime && player?.getDuration) {
        const isAdPlaying = (player && typeof player.getAdState === 'function' && player.getAdState() === 1);
        if (isAdPlaying) {
            forceHideLoader();
            return;
        }
        const curr = player.getCurrentTime(), dur = player.getDuration();
        if (dur > 0) {
            document.getElementById('pFill').style.width = (curr/dur*100) + '%';
            document.getElementById('currTime').innerText = formatTime(curr);
            document.getElementById('totalTime').innerText = formatTime(dur);
        }
    }
}

function toggleControls(e) {
    if (e.target.closest('.player-controls') || e.target.closest('.p-bar-container')) return;
    const el = document.getElementById('playerArea');
    clearTimeout(hideTimeout);
    if (el.classList.contains('show-ui')) el.classList.remove('show-ui');
    else showControls();
}

function showControls() {
    const el = document.getElementById('playerArea');
    clearTimeout(hideTimeout);
    el.classList.add('show-ui');
    if (!isBuffering && player && player.getPlayerState() === YT.PlayerState.PLAYING) {
        hideTimeout = setTimeout(() => el.classList.remove('show-ui'), 3000);
    }
}

function playPause() {
    if (!player) return;
    player.getPlayerState() === YT.PlayerState.PLAYING ? player.pauseVideo() : player.playVideo();
    showControls();
}

function skip(s) {
    if (player?.getCurrentTime) {
        player.seekTo(player.getCurrentTime() + s, true);
        showControls();
    }
}

function toggleFullscreen() {
    const el = document.getElementById('playerArea');
    if (!document.fullscreenElement) {
        if (el.requestFullscreen) el.requestFullscreen();
        else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
    } else {
        if (document.exitFullscreen) document.exitFullscreen();
    }
    showControls();
}

function closePlayer() {
    document.getElementById('playerBox').style.display = 'none';
    document.body.classList.remove('player-open');
    if (player?.stopVideo) player.stopVideo();
}

function formatTime(s) {
    const m = Math.floor(s/60), sc = Math.floor(s%60);
    return `${m}:${sc < 10 ? '0' : ''}${sc}`;
}

function seek(e) {
    if (!player?.getDuration) return;
    const rect = e.currentTarget.getBoundingClientRect();
    player.seekTo(((e.clientX - rect.left) / rect.width) * player.getDuration(), true);
    showControls();
}

function updateDramaPagination() {
    const prev = document.getElementById('dramaPrevBtn'), next = document.getElementById('dramaNextBtn');
    if(prev) prev.disabled = dramaCurrentPage === 1;
    if(next) next.disabled = dramaCurrentPage === dramaTotalPages;
    const info = document.getElementById('dramaPageInfo');
    if(info) info.textContent = `Page ${dramaCurrentPage} of ${dramaTotalPages}`;
    const pNav = document.getElementById('dramaPagination');
    if(pNav) pNav.style.display = DRAMAS.length > ITEMS_PER_PAGE ? 'flex' : 'none';
}

function updateEpisodePagination() {
    const prev = document.getElementById('episodePrevBtn'), next = document.getElementById('episodeNextBtn');
    if(prev) prev.disabled = episodeCurrentPage === 1;
    if(next) next.disabled = episodeCurrentPage === episodeTotalPages;
    const info = document.getElementById('episodePageInfo');
    if(info) info.textContent = `Page ${episodeCurrentPage} of ${episodeTotalPages}`;
    const pNav = document.getElementById('episodePagination');
    if(pNav) pNav.style.display = videoList.length > ITEMS_PER_PAGE ? 'flex' : 'none';
}

function changeDramaPage(dir) { 
    dramaCurrentPage += dir; 
    showFullScreenLoader('Loading More Dramas');
    setTimeout(() => { initializeDramas(); hideFullScreenLoader(); window.scrollTo(0,0); }, 800);
}

function changeEpisodePage(dir) { 
    showFullScreenLoader('Loading More Episodes');
    setTimeout(() => { displayEpisodes(episodeCurrentPage + dir); hideFullScreenLoader(); window.scrollTo(0,0); }, 800);
}

const playerArea = document.getElementById('playerArea');
if(playerArea) playerArea.addEventListener('click', toggleControls);

document.addEventListener('keydown', (e) => {
    if (document.getElementById('playerBox').style.display === 'none') return;
    if (e.key === ' ') { e.preventDefault(); playPause(); }
    if (e.key === 'ArrowLeft') skip(-10);
    if (e.key === 'ArrowRight') skip(10);
    if (e.key === 'Escape') closePlayer();
});

setInterval(() => {
    const dots = document.querySelectorAll('.loading-dots');
    dots.forEach(dot => {
        const current = dot.textContent;
        if (current === '...') dot.textContent = '';
        else if (current === '..') dot.textContent = '...';
        else if (current === '.') dot.textContent = '..';
        else dot.textContent = '.';
    });
}, 500);
</script>
</body>
</html>
